<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<script src="js/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" href="css/sample.css">
<title>じゃんけん</title>
<script>
$(function(){
    
    //判定
    var win  = "勝ち";
    var drw  = "引き分け";
    var def  = "負け";

    //相手の出した手
    var cho  = "チョキ";
    var guu  = "グー";
    var par  = "パー";

    //localstrageから勝ち負け回数を取得
    var winNum = localStorage.getItem("winNum") ? parseInt(localStorage.getItem("winNum")) : 0;
    var drwNum = localStorage.getItem("drwNum") ? parseInt(localStorage.getItem("drwNum")) : 0;
    var defNum = localStorage.getItem("defNum") ? parseInt(localStorage.getItem("defNum")) : 0;
    var count = localStorage.getItem("count") ? parseInt(localStorage.getItem("count")) : 0;

    loadNum();

    //チョキ
    $("#cho_btn").on("click",function(){
        var rand = Math.floor(Math.random()*3);
        var result;
        if (rand==0) {
            $("#aite").html(guu);
            $("#num").html(def);
            insertResult(def);
        }else if (rand==1) {
            $("#aite").html(cho);
            $("#num").html(drw);
            insertResult(drw);
        }else {
            $("#aite").html(par);
            $("#num").html(win);
            insertResult(win);
        }
    });

    //グー
    $("#gu_btn").on("click",function(){
        var rand = Math.floor(Math.random()*3);
        if (rand==0) {
            $("#aite").html(guu);
            $("#num").html(drw);
            insertResult(drw);
        }else if (rand==1) {
            $("#aite").html(cho);
            $("#num").html(win);
            insertResult(win);
        }else {
            $("#aite").html(par);
            $("#num").html(def);
            insertResult(def);
        }
    });

    //パー
    $("#par_btn").on("click",function(){
        var rand = Math.floor(Math.random()*3);
        if (rand==0) {
            $("#aite").html(guu);
            $("#num").html(win);
            insertResult(win);
        }else if (rand==1) {
            $("#aite").html(cho);
            $("#num").html(def);
            insertResult(def);
        }else {
            $("#aite").html(par);
            $("#num").html(drw);
            insertResult(drw);
        }
    });

    function insertResult(result){
 
        if (result == win) {
            winNum = winNum + 1;
        }else if (result == def) {
            defNum = defNum + 1;
        }else {
            drwNum = drwNum + 1;
        }

        count = count + 1;

        //対戦回数100回超えるごとにリセットするかきく
        if (count % 100 == 0) {
            var res = confirm("対戦が" + count + "回超えましたー続けますか？");
            if (res) {
                //ローカルストレージに勝ち負け回数をセット
                localStorage.setItem("winNum",winNum);
                localStorage.setItem("defNum",defNum);
                localStorage.setItem("drwNum",drwNum);
                localStorage.setItem("count",count);
            } else {
                localStorage.setItem("winNum",0);
                localStorage.setItem("defNum",0);
                localStorage.setItem("drwNum",0);
                localStorage.setItem("count",0);
                winNum = 0;
                defNum = 0;
                drwNum = 0;
                count = 0;
            }
        } else {
            //ローカルストレージに勝ち負け回数をセット
            localStorage.setItem("winNum",winNum);
            localStorage.setItem("defNum",defNum);
            localStorage.setItem("drwNum",drwNum);
            localStorage.setItem("count",count);
        }

        loadNum();
    }

    function loadNum() {
        $("#win_num").html(winNum);
        $("#drw_num").html(drwNum);
        $("#def_num").html(defNum);
        $("#win_per").html(Math.floor( winNum / (winNum + defNum + drwNum) * 100 ? winNum / (winNum + defNum + drwNum) * 100 : 0) + "%");
        $("#count").html(count);
    }
});
</script>
</head>
<body>

<header>
  <h1>じゃんけん</h1>
</header>

<main>
  <ul>
    <li id="gu_btn">グー</li>
    <li id="cho_btn">チョキ</li>
    <li id="par_btn">パー</li>
  </ul>
  <div>コンピュータの出した手は？</div>
  <div id="aite"></div>
  <div id="num">勝ち</div>
  <div id="result">
    <div>結果</div>
    <div id="win">勝ち:<span id="win_num"></span></div>
    <div id="drw">分け:<span id="drw_num"></span></div>
    <div id="def">負け:<span id="def_num"></span></div>    
    <div id="def">勝率:<span id="win_per"></span></div>    
    <div id="def">対戦回数:<span id="count"></span></div>    
  </div>
</main>

<footer></footer>

</body>
</html>
